# Sparkify Analytics Database & ETL

## Objective

Provide a functional database with songs users are listening to,
so the analytics team can work with.

## Datasets

The data used in the ETL pipeline is from the original files 
(in JSON), generated by the music streaming app. There are two
datasets, described bellow:

- Songs Dataset: Contains metadata about a song and the artist
of that song.

```json
{"num_songs": 1, "artist_id": "ARJIE2Y1187B994AB7", "artist_latitude": null, "artist_longitude": null, "artist_location": "", "artist_name": "Line Renaud", "song_id": "SOUPIRU12A6D4FA1E1", "title": "Der Kleine Dompfaff", "duration": 152.92036, "year": 0}
```

- Log Dataset: Activity from the music app. 

## Running 

To run the project you are going to need Pipenv. Pipenv is used 
so you don't need to install the dependencies locally. 

```commandline
$ pipenv run python <file.py>
```

## Starting

There are two main scripts to run in order to create the database
and importing the data. 

The first one, "create_tables.py", will
drop the tables if they exists and re-creating them. 

```commandline
$ pipenv run python create_tables.py
```

The second one, "etl.py", will load song and log data from the 
datasets located on "data" folder and insert this date properly 
on the tables previously created.

```commandline
$ pipenv run python etl.py
```

Both scripts use "sql_queries.py" in order to achieve the result.
There are some auxiliary .ipynb files that were used to create
the tables. 

## Docker Database Enviroment 

Run postgres docker image  w/ enviroment config and name (postgres_dend)

```commandline
$ docker run \
    --name postgres_dend \
    -e POSTGRES_USER=renato \
    -e POSTGRES_PASSWORD= \
    -e POSTGRES_DB=default \
    -d \
    -p 5432:5432 \
    postgres
```

Stop the container:

```commandline
$ docker ps
$ docker kill <container_id>
```

Start the container:
```commandline
$ docker start postgres_dend
```

Connect w/ psql:

```commandline
$ psql -hlocalhost -Urenato -ddefault # for default db
$ psql -hlocalhost -Urenato -dsparkifydb # project created database
```

Remove container (remove all data, while stop just stop running)

```commandline
$ docker ps -a
$ docker rm <container_id>
```